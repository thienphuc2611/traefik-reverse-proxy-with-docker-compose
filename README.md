# Traefik Reverse Proxy with Docker Compose

This guide will help you deploy a production-ready Traefik v3 reverse proxy using Docker Compose. It covers automatic SSL with Let's Encrypt, dynamic configuration, and how to add new sites and applications.

---

## Directory Structure

```
traefik/
├── docker-compose.yml         # Main Docker Compose file for Traefik
├── traefik.yml                # Static Traefik configuration
├── letsencrypt/               # Stores SSL certificates (acme.json)
├── dynamic/                   # Dynamic configuration directory
│   ├── middlewares/           # Common middlewares (gzip, rate-limit, etc.)
│   └── sites/                 # Per-site configuration files
```

---

## Prerequisites
- Docker & Docker Compose installed
- A domain name pointed to your server's public IP

---

## 1. Clone the Repository
```bash
git clone <your-repo-url>
cd traefik
```

---

## 2. Configure Traefik
- Open `docker-compose.yml` and set your email for Let's Encrypt in the `command:` section:
  ```yaml
  - --certificatesresolvers.letsencrypt.acme.email=your@email.com
  ```
- (Optional) Edit `traefik.yml` for advanced static settings.

---

## 3. Prepare SSL Storage
```bash
mkdir -p letsencrypt
chmod 600 letsencrypt/acme.json || touch letsencrypt/acme.json && chmod 600 letsencrypt/acme.json
```

---

## 4. Create Traefik Network
If you use an external network in your `docker-compose.yml`, you must create it before starting Traefik:
```bash
docker network create traefik-network
```

---

## 5. Start Traefik
```bash
docker-compose up -d
```
- Traefik will listen on ports 80 (HTTP) and 443 (HTTPS).
- The dashboard is available at https://<your-domain>:8080 (if enabled).

---

## 6. Add a New Site
1. **Copy the template:**
   ```bash
   cp dynamic/sites/_template-site.yml dynamic/sites/example.com.yml
   ```
2. **Edit `example.com.yml`:**
   - Set `rule: "Host(`example.com`)"`
   - Set the correct service name and container name
   - Example:
     ```yaml
     http:
       routers:
         example:
           rule: "Host(`example.com`)"
           entryPoints:
             - websecure
           tls:
             certResolver: letsencrypt
           middlewares:
             - redirect-https@file
             - secure-headers@file
             - gzip@file
             - rate-limit@file
             - cache-static@file
           service: example
       services:
         example:
           loadBalancer:
             servers:
               - url: "http://your-app-container:80"
     ```
3. **Ensure your app container is on the same Docker network as Traefik** (see next step).

---

## 7. Connect Your App to the Traefik Network
In your app's `docker-compose.yml`, add the following:
```yaml
networks:
  traefik:
    external: true
    name: traefik-network

services:
  your-app:
    image: ...
    networks:
      - traefik
```
- This allows Traefik to route traffic to your app container.

---

## 8. Reload Traefik
Traefik automatically reloads dynamic configuration. If you need to force reload:
```bash
docker-compose restart traefik
```

---

## 9. Check SSL and Routing
- Visit your domain: https://example.com
- SSL should be valid (auto-generated by Let's Encrypt)
- Your app should be accessible via Traefik

---

## 10. Useful Commands
- **View Traefik logs:**
  ```bash
  docker-compose logs -f traefik
  ```
- **Check running containers:**
  ```bash
  docker ps
  ```
- **List Docker networks:**
  ```bash
  docker network ls
  ```
- **Inspect a network:**
  ```bash
  docker network inspect traefik-network
  ```

---

## 11. Security Notes
- Keep your `letsencrypt/acme.json` file secure (`chmod 600`).
- Do not expose the Traefik dashboard publicly unless you secure it with authentication or firewall rules.
- Regularly update Traefik and your containers for security patches.

---

## 12. References
- [Traefik Documentation](https://doc.traefik.io/traefik/)
- [Let's Encrypt](https://letsencrypt.org/)

---

Happy reverse proxying! 